<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 500">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#61DAFB"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="500" fill="#1a1a1a"/>
  
  <!-- Title -->
  <text x="450" y="40" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="24" font-weight="bold" text-anchor="middle">Flujo de useQuery</text>
  
  <!-- Step 1: Initial Call -->
  <rect x="50" y="80" width="160" height="90" rx="8" fill="#61DAFB" fill-opacity="0.15" stroke="#61DAFB" stroke-width="2"/>
  <text x="130" y="110" fill="#61DAFB" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">1. useQuery()</text>
  <text x="130" y="135" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="11" text-anchor="middle">Componente monta</text>
  <text x="130" y="155" fill="#888888" font-family="Inter, system-ui, sans-serif" font-size="10" text-anchor="middle">queryKey + queryFn</text>
  
  <line x1="210" y1="125" x2="250" y2="125" stroke="#61DAFB" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Step 2: Cache Check -->
  <rect x="250" y="80" width="160" height="90" rx="8" fill="#3178C6" fill-opacity="0.15" stroke="#3178C6" stroke-width="2"/>
  <text x="330" y="110" fill="#3178C6" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">2. Check Cache</text>
  <text x="330" y="135" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="11" text-anchor="middle">¿Hay datos?</text>
  <text x="330" y="155" fill="#888888" font-family="Inter, system-ui, sans-serif" font-size="10" text-anchor="middle">¿Están frescos?</text>
  
  <!-- Branch: No Cache -->
  <line x1="330" y1="170" x2="330" y2="210" stroke="#ef4444" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="360" y="195" fill="#ef4444" font-family="Inter, system-ui, sans-serif" font-size="10">No hay</text>
  
  <!-- Branch: Has Cache Fresh -->
  <line x1="410" y1="125" x2="450" y2="125" stroke="#10b981" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="430" y="115" fill="#10b981" font-family="Inter, system-ui, sans-serif" font-size="10">Fresh</text>
  
  <!-- Branch: Has Cache Stale -->
  <line x1="410" y1="145" x2="450" y2="200" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="445" y="165" fill="#f59e0b" font-family="Inter, system-ui, sans-serif" font-size="10">Stale</text>
  
  <!-- Step 3a: Return Cache (Fresh) -->
  <rect x="450" y="80" width="160" height="90" rx="8" fill="#10b981" fill-opacity="0.15" stroke="#10b981" stroke-width="2"/>
  <text x="530" y="110" fill="#10b981" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">3a. Return Data</text>
  <text x="530" y="135" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="11" text-anchor="middle">Datos del cache</text>
  <text x="530" y="155" fill="#888888" font-family="Inter, system-ui, sans-serif" font-size="10" text-anchor="middle">isSuccess: true</text>
  
  <!-- Step 3b: Fetch (No cache or Stale) -->
  <rect x="250" y="210" width="160" height="90" rx="8" fill="#f59e0b" fill-opacity="0.15" stroke="#f59e0b" stroke-width="2"/>
  <text x="330" y="240" fill="#f59e0b" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">3b. Fetch Data</text>
  <text x="330" y="265" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="11" text-anchor="middle">Llamar queryFn</text>
  <text x="330" y="285" fill="#888888" font-family="Inter, system-ui, sans-serif" font-size="10" text-anchor="middle">isFetching: true</text>
  
  <!-- Step 3c: Show Stale Data + Fetch -->
  <rect x="450" y="180" width="160" height="90" rx="8" fill="#f59e0b" fill-opacity="0.15" stroke="#f59e0b" stroke-width="2"/>
  <text x="530" y="205" fill="#f59e0b" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">3c. Stale While</text>
  <text x="530" y="225" fill="#f59e0b" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Revalidate</text>
  <text x="530" y="250" fill="#888888" font-family="Inter, system-ui, sans-serif" font-size="10" text-anchor="middle">Mostrar cache +</text>
  <text x="530" y="265" fill="#888888" font-family="Inter, system-ui, sans-serif" font-size="10" text-anchor="middle">fetch en background</text>
  
  <!-- Step 4: Update Cache -->
  <line x1="410" y1="255" x2="450" y2="330" stroke="#3178C6" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="530" y1="270" x2="530" y2="310" stroke="#3178C6" stroke-width="2" marker-end="url(#arrow)"/>
  
  <rect x="450" y="310" width="160" height="90" rx="8" fill="#3178C6" fill-opacity="0.15" stroke="#3178C6" stroke-width="2"/>
  <text x="530" y="340" fill="#3178C6" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">4. Update Cache</text>
  <text x="530" y="365" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="11" text-anchor="middle">Guardar nuevos datos</text>
  <text x="530" y="385" fill="#888888" font-family="Inter, system-ui, sans-serif" font-size="10" text-anchor="middle">dataUpdatedAt: now</text>
  
  <!-- Step 5: Re-render -->
  <line x1="610" y1="355" x2="650" y2="355" stroke="#61DAFB" stroke-width="2" marker-end="url(#arrow)"/>
  
  <rect x="650" y="310" width="160" height="90" rx="8" fill="#61DAFB" fill-opacity="0.15" stroke="#61DAFB" stroke-width="2"/>
  <text x="730" y="340" fill="#61DAFB" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">5. Re-render</text>
  <text x="730" y="365" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="11" text-anchor="middle">UI actualizada</text>
  <text x="730" y="385" fill="#888888" font-family="Inter, system-ui, sans-serif" font-size="10" text-anchor="middle">isSuccess: true</text>
  
  <!-- Error Path -->
  <rect x="50" y="210" width="160" height="90" rx="8" fill="#ef4444" fill-opacity="0.15" stroke="#ef4444" stroke-width="2"/>
  <text x="130" y="240" fill="#ef4444" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">Error Path</text>
  <text x="130" y="265" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="11" text-anchor="middle">Si fetch falla</text>
  <text x="130" y="285" fill="#888888" font-family="Inter, system-ui, sans-serif" font-size="10" text-anchor="middle">isError: true</text>
  
  <line x1="250" y1="280" x2="210" y2="260" stroke="#ef4444" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Retry indicator -->
  <path d="M 130 300 Q 130 330 180 330 Q 230 330 250 290" stroke="#ef4444" stroke-width="1" fill="none" stroke-dasharray="4"/>
  <text x="180" y="350" fill="#ef4444" font-family="Inter, system-ui, sans-serif" font-size="10" text-anchor="middle">Retry (default: 3)</text>
  
  <!-- Legend -->
  <rect x="650" y="80" width="220" height="180" rx="8" fill="#2d2d2d" stroke="#444444" stroke-width="1"/>
  <text x="760" y="105" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">Query States</text>
  
  <circle cx="675" cy="130" r="6" fill="#f59e0b"/>
  <text x="695" y="134" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="11">isPending / isLoading</text>
  
  <circle cx="675" cy="155" r="6" fill="#3178C6"/>
  <text x="695" y="159" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="11">isFetching</text>
  
  <circle cx="675" cy="180" r="6" fill="#10b981"/>
  <text x="695" y="184" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="11">isSuccess</text>
  
  <circle cx="675" cy="205" r="6" fill="#ef4444"/>
  <text x="695" y="209" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="11">isError</text>
  
  <circle cx="675" cy="230" r="6" fill="#888888"/>
  <text x="695" y="234" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="11">isStale</text>
  
  <!-- Footer note -->
  <text x="450" y="470" fill="#888888" font-family="Inter, system-ui, sans-serif" font-size="12" text-anchor="middle">isLoading = isPending &amp;&amp; !data (primera carga sin cache)</text>
  <text x="450" y="490" fill="#888888" font-family="Inter, system-ui, sans-serif" font-size="12" text-anchor="middle">isFetching = true siempre que hay un fetch en progreso</text>
</svg>